{% extends 'base.html' %}

{% block title %}Market Sentiment - Market Manus{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2><i class="bi bi-emoji-smile"></i> Market Sentiment Analysis</h2>
            <p class="text-muted">An치lise de sentimento do mercado cripto</p>
        </div>
    </div>

    <!-- Asset Selection -->
    <div class="row mt-3">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <label class="form-label">Selecionar Ativo:</label>
                    <select class="form-select" id="sentiment-asset" onchange="loadSentiment()">
                        <option value="BTCUSDT" selected>Bitcoin (BTC)</option>
                        <option value="ETHUSDT">Ethereum (ETH)</option>
                        <option value="BNBUSDT">Binance Coin (BNB)</option>
                        <option value="SOLUSDT">Solana (SOL)</option>
                        <option value="XRPUSDT">Ripple (XRP)</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <button class="btn btn-primary w-100" onclick="loadSentiment()">
                        <i class="bi bi-arrow-clockwise"></i> Atualizar An치lise
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fear & Greed Index -->
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-header">
                    <i class="bi bi-speedometer2"></i> Fear & Greed Index
                </div>
                <div class="card-body">
                    <div id="fear-greed-loader" class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <div id="fear-greed-content" style="display: none;">
                        <h1 id="fear-greed-value" class="display-3 mb-2">--</h1>
                        <h4 id="fear-greed-label" class="text-muted">--</h4>
                        <p class="text-muted mb-0" id="fear-greed-update">칔ltima atualiza칞칚o: --</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-graph-up-arrow"></i> Market Prognosis
                </div>
                <div class="card-body">
                    <div id="prognosis-loader" class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                    </div>
                    <div id="prognosis-content" style="display: none;">
                        <div class="alert alert-info">
                            <h5 id="prognosis-title">游늵 An치lise de Mercado</h5>
                            <p id="prognosis-text" class="mb-0">Carregando an치lise...</p>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <p><strong>Regime:</strong> <span id="market-regime" class="badge bg-primary">--</span></p>
                                <p><strong>Tend칡ncia:</strong> <span id="market-trend">--</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Volatilidade:</strong> <span id="market-volatility">--</span></p>
                                <p><strong>Recomenda칞칚o:</strong> <span id="market-recommendation">--</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicators Grid -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="bi bi-bar-chart-line fs-1 text-primary"></i>
                    <h6 class="mt-3">Volume 24h</h6>
                    <h4 id="volume-24h">--</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="bi bi-currency-dollar fs-1 text-success"></i>
                    <h6 class="mt-3">Market Cap</h6>
                    <h4 id="market-cap">--</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="bi bi-activity fs-1 text-warning"></i>
                    <h6 class="mt-3">Volatilidade</h6>
                    <h4 id="volatility">--</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <i class="bi bi-graph-up fs-1 text-info"></i>
                    <h6 class="mt-3">Mudan칞a 24h</h6>
                    <h4 id="change-24h">--</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Social Sentiment -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-chat-dots"></i> Sentimento Social
                </div>
                <div class="card-body">
                    <div id="social-loader" class="loading-block">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <span class="state-label"><i class="bi bi-chat-dots"></i> Coletando sentimento social...</span>
                    </div>
                    <div id="social-content" style="display: none;">
                        <p id="social-text" class="mb-0">An치lise de sentimento social ser치 exibida aqui...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function loadSentiment() {
    const asset = document.getElementById('sentiment-asset').value;
    
    // Show loaders
    document.getElementById('fear-greed-loader').style.display = 'block';
    document.getElementById('fear-greed-content').style.display = 'none';
    document.getElementById('prognosis-loader').style.display = 'block';
    document.getElementById('prognosis-content').style.display = 'none';
    document.getElementById('social-loader').style.display = 'block';
    document.getElementById('social-content').style.display = 'none';
    
    try {
        const response = await fetch(`/api/sentiment/${asset}`);
        const data = await response.json();
        
        // Fear & Greed
        if (data.fear_greed) {
            document.getElementById('fear-greed-value').textContent = data.fear_greed.value;
            document.getElementById('fear-greed-label').textContent = data.fear_greed.label;
            
            const fgLabel = document.getElementById('fear-greed-label');
            if (data.fear_greed.label.includes('Extreme Fear')) {
                fgLabel.className = 'text-danger';
            } else if (data.fear_greed.label.includes('Fear')) {
                fgLabel.className = 'text-warning';
            } else if (data.fear_greed.label.includes('Greed')) {
                fgLabel.className = 'text-success';
            } else {
                fgLabel.className = 'text-muted';
            }
            
            document.getElementById('fear-greed-loader').style.display = 'none';
            document.getElementById('fear-greed-content').style.display = 'block';
        }
        
        // Market Prognosis
        if (data.prognosis) {
            document.getElementById('prognosis-title').textContent = `游늵 ${data.prognosis.title}`;
            document.getElementById('prognosis-text').textContent = data.prognosis.description;
            document.getElementById('market-regime').textContent = data.prognosis.regime || 'NEUTRO';
            document.getElementById('market-trend').textContent = data.prognosis.trend || '--';
            document.getElementById('market-volatility').textContent = data.prognosis.volatility || '--';
            document.getElementById('market-recommendation').textContent = data.prognosis.recommendation || '--';
            
            document.getElementById('prognosis-loader').style.display = 'none';
            document.getElementById('prognosis-content').style.display = 'block';
        }
        
        // Market Data
        if (data.market_data) {
            document.getElementById('volume-24h').textContent = data.market_data.volume_24h || '--';
            document.getElementById('market-cap').textContent = data.market_data.market_cap || '--';
            document.getElementById('volatility').textContent = data.market_data.volatility || '--';
            
            const change = parseFloat(data.market_data.change_24h) || 0;
            const changeEl = document.getElementById('change-24h');
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeEl.className = change >= 0 ? 'text-success' : 'text-danger';
        }
        
        // Social Sentiment
        if (data.social) {
            document.getElementById('social-text').textContent = data.social.summary || 'Sem dados dispon칤veis';
            document.getElementById('social-loader').style.display = 'none';
            document.getElementById('social-content').style.display = 'block';
        }
        
    } catch (error) {
        console.error('Erro ao carregar sentimento:', error);
        alert('Erro ao carregar an치lise de sentimento');
    }
}

// Carregar ao iniciar
document.addEventListener('DOMContentLoaded', loadSentiment);
</script>
{% endblock %}
